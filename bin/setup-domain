#!/bin/bash

DOMAIN=$1

if [ -z "$DOMAIN" ]; then
  echo "Usage: ./bin/setup-domain your-custom-domain.com"
  exit 1
fi

# Update environment variables with the custom domain
sed -i "s/^DOMAIN=.*/DOMAIN=$DOMAIN/" .env

# Update Nginx configuration with the custom domain
sed -i "s/\${DOMAIN}/$DOMAIN/g" docker/nginx/default.conf

# Restart the Nginx container
docker-compose -f compose/docker-compose.yml restart web

# Obtain SSL certificates using Certbot
docker-compose -f compose/docker-compose.yml run --rm certbot certonly --webroot --webroot-path=/var/www/certbot --email your-email@example.com --agree-tos --no-eff-email -d $DOMAIN

# Reload Nginx with the new certificates
docker-compose -f compose/docker-compose.yml restart web

echo "Custom domain setup complete. Your application is now accessible at https://$DOMAIN"